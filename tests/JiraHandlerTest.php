<?php

declare(strict_types=1);

namespace Artack\Monolog\JiraHandler;

use Http\Mock\Client;
use Monolog\Logger;
use Nyholm\Psr7\Response;
use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\ResponseInterface;

class JiraHandlerTest extends BaseTestCase
{
    private const RESPONSE_HEADERS = [
        'Server' => 'nginx/1.10.3 (Ubuntu)',
        'Date' => 'Mon, 25 Feb 2019 10:54:47 GMT',
        'Content-Type' => 'application/json;charset=UTF-8',
    ];

    private const RESPONSE_BODY_CUSTOMFIELDS = '{"maxResults":50,"startAt":0,"total":35,"isLast":true,"values":[{"id":"customfield_10507","name":"Acceptance criterias","type":"Text Field (multi-line)","searcherKey":"Acceptance criterias","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10507","numericId":10507,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":6},{"id":"customfield_10701","name":"BV","description":"Business Value (by Commercial, Market, Efficiency, Customer and Future Value).\r\n<!-- @@Formula: \r\nimport java.text.DecimalFormat;\r\nimport java.text.NumberFormat;\r\n\r\nlog.error(\"Value of field 10500 (commercial) is: \"+issue.get(\"customfield_10500\"));\r\nlog.error(\"Value of field 10501 (market) is: \"+issue.get(\"customfield_10501\"));\r\nlog.error(\"Value of field 10503 (efficiency) is: \"+issue.get(\"customfield_10503\"));\r\nlog.error(\"Value of field 10504 (customer) is: \"+issue.get(\"customfield_10504\"));\r\nlog.error(\"Value of field 10505 (future) is: \"+issue.get(\"customfield_10505\"));\r\n \r\nif (issue.get(\"customfield_10500\") == null || issue.get(\"customfield_10501\") == null || issue.get(\"customfield_10503\") == null || issue.get(\"customfield_10504\") == null || issue.get(\"customfield_10505\") == null)\r\n    return null;\r\n \r\nNumberFormat formatter = new DecimalFormat(\"#0.00\");\r\n\r\nreturn formatter.format((issue.get(\"customfield_10500\") * 6 + issue.get(\"customfield_10501\") * 5 + issue.get(\"customfield_10503\") * 1 + issue.get(\"customfield_10504\") * 2 + issue.get(\"customfield_10505\") * 1) / 15);\r\n-->","type":"Calculated Number Field","searcherKey":"BV","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10701","numericId":10701,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":1},{"id":"customfield_10702","name":"BVS","description":"Business Value Score (by BV and EST)\r\n<!-- @@Formula: \r\nimport java.text.DecimalFormat;\r\nimport java.text.NumberFormat;\r\n\r\nlog.error(\"Value of field 10701 (BV) is: \"+issue.get(\"customfield_10701\"));\r\nlog.error(\"Value of field timeoriginalestimate is: \"+issue.get(\"timeoriginalestimate\"));\r\n \r\nif (issue.get(\"customfield_10701\") == null || issue.get(\"timeoriginalestimate\") == null)\r\n    return null;\r\n\r\nNumberFormat formatter = new DecimalFormat(\"#0\");\r\ndouble value = (1000 * issue.get(\"customfield_10701\") * issue.get(\"customfield_10701\") * issue.get(\"customfield_10701\") * issue.get(\"customfield_10701\")) / (21 * issue.get(\"timeoriginalestimate\") / 60 / 60);\r\n\r\nif (value > 100)\r\n    value = 100;\r\n\r\nreturn formatter.format(value);\r\n-->","type":"Calculated Number Field","searcherKey":"BVS","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10702","numericId":10702,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":1},{"id":"customfield_10003","name":"Business Value","description":"Measurement of business value of a requirement.","type":"Number Field","searcherKey":"Business Value","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10003","numericId":10003,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":1},{"id":"customfield_10500","name":"Commercial value","description":"How much profit or revenue will this generate?","type":"Number Field","searcherKey":"Commercial value","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10500","numericId":10500,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":4},{"id":"customfield_10504","name":"Customer value","description":"To what extent will this decrease the likeliness that customers will abandon our product?","type":"Number Field","searcherKey":"Customer value","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10504","numericId":10504,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":4},{"id":"customfield_10600","name":"Development","description":"Development Summary Field for JIRA Software use only.","type":"Development Summary","searcherKey":"Development","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10600","numericId":10600,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10503","name":"Efficiency value","description":"How much time or money will this save us?","type":"Number Field","searcherKey":"Efficiency value","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10503","numericId":10503,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":4},{"id":"customfield_10009","name":"Epic Color","description":"Epic Colour field for Jira Software use only.","type":"Color of Epic","searcherKey":"Epic Color","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10009","numericId":10009,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10006","name":"Epic Link","description":"Choose an epic to assign this issue to.","type":"Epic Link Relationship","searcherKey":"Epic Link","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10006","numericId":10006,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":12},{"id":"customfield_10007","name":"Epic Name","description":"Provide a short name to identify this epic.","type":"Name of Epic","searcherKey":"Epic Name","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10007","numericId":10007,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":4},{"id":"customfield_10008","name":"Epic Status","description":"Epic Status field for Jira Software use only.","type":"Status of Epic","searcherKey":"Epic Status","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10008","numericId":10008,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10001","name":"Epic/Theme","description":"Field that will help you regroup issues under an Epic or under a theme.","type":"Labels","searcherKey":"Epic/Theme","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10001","numericId":10001,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10800","name":"External issue ID","description":"External issue ID created by JIM during import process","type":"Text Field (single line)","searcherKey":"External issue ID","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10800","numericId":10800,"isLocked":false,"isManaged":false,"isAllProjects":false,"projectsCount":1,"screensCount":1},{"id":"customfield_10000","name":"Flagged","description":"Allows to flag issues with impediments.","type":"Checkboxes","searcherKey":"Flagged","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10000","numericId":10000,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10505","name":"Future value","description":"How much time or money will this save us in the future?","type":"Number Field","searcherKey":"Future value","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10505","numericId":10505,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":4},{"id":"customfield_10103","name":"JIRA Capture Browser","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture Browser","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10103","numericId":10103,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10108","name":"JIRA Capture Document Mode","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture Document Mode","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10108","numericId":10108,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10104","name":"JIRA Capture Operating System","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture Operating System","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10104","numericId":10104,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10106","name":"JIRA Capture Screen Resolution","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture Screen Resolution","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10106","numericId":10106,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10105","name":"JIRA Capture URL","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture URL","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10105","numericId":10105,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10102","name":"JIRA Capture User Agent","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture User Agent","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10102","numericId":10102,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10107","name":"JIRA Capture jQuery Version","description":"This Custom Field is created programatically by JIRA Capture.","type":"Capture for JIRA text","searcherKey":"JIRA Capture jQuery Version","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10107","numericId":10107,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10901","name":"Logcount","type":"Number Field","searcherKey":"Logcount","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10901","numericId":10901,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":3},{"id":"customfield_10900","name":"Loghash","type":"Text Field (single line)","searcherKey":"Loghash","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10900","numericId":10900,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":3},{"id":"customfield_10501","name":"Market value","description":"How many new customers will we be able to serve?","type":"Number Field","searcherKey":"Market value","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10501","numericId":10501,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":4},{"id":"customfield_10400","name":"Offer","type":"Text Field (single line)","searcherKey":"Offer","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10400","numericId":10400,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":3},{"id":"customfield_10101","name":"Raised During","description":"This Custom Field is created programmatically by JIRA Capture.","type":"Capture for JIRA test session","searcherKey":"Raised During","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10101","numericId":10101,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10010","name":"Rank","description":"Global rank field for Jira Software use only.","type":"Global Rank","searcherKey":"Rank","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10010","numericId":10010,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10110","name":"Release Version History","description":"The released versions an incomplete issue has been in when it was forwarded to the next sprint","type":"Jira Released Version History","searcherKey":"Release Version History","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10110","numericId":10110,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10005","name":"Sprint","description":"Jira Software sprint field","type":"Jira Sprint Field","searcherKey":"Sprint","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10005","numericId":10005,"isLocked":true,"isManaged":true,"isAllProjects":true,"projectsCount":0,"screensCount":1},{"id":"customfield_10002","name":"Story Points","description":"Measurement of complexity and/or size of a requirement.","type":"Number Field","searcherKey":"Story Points","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10002","numericId":10002,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":1},{"id":"customfield_10100","name":"Test Sessions","description":"This Custom Field is created programmatically by JIRA Capture.","type":"Capture for JIRA test sessions","searcherKey":"Test Sessions","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10100","numericId":10100,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10109","name":"Testing Status","description":"This Custom Field is created programmatically by JIRA Capture.","type":"Capture for JIRA testing status","searcherKey":"Testing Status","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10109","numericId":10109,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0},{"id":"customfield_10202","name":"Total Remaining Estimate","type":"Number Field","searcherKey":"Total Remaining Estimate","self":"https://jira.artack.ch/rest/api/2/customFields/customfield_10202","numericId":10202,"isLocked":false,"isManaged":false,"isAllProjects":true,"projectsCount":0,"screensCount":0}]}';
    private const RESPONSE_BODY_EXISTING_ISSUES_NONE = '{"startAt":0,"maxResults":50,"total":0,"issues":[]}';
    private const RESPONSE_BODY_EXISTING_ISSUES_ONE = '{"expand":"names,schema","startAt":0,"maxResults":50,"total":1,"issues":[{"expand":"operations,versionedRepresentations,editmeta,changelog,renderedFields","id":"21103","self":"https://jira.artack.ch/rest/api/2/issue/21103","key":"MX-2311","fields":{"summary":"CRITICAL: jetzt hets klöpft. :)","issuetype":{"self":"https://jira.artack.ch/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":10303},"customfield_10900":"b6647ac4deb11ecd84ece68ade9ac0a8","customfield_10901":1.0,"status":{"self":"https://jira.artack.ch/rest/api/2/status/10700","description":"","iconUrl":"https://jira.artack.ch/","name":"Backlog","id":"10700","statusCategory":{"self":"https://jira.artack.ch/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}}}}]}';
    private const RESPONSE_BODY_CREATE_META = '{"expand":"projects","projects":[{"expand":"issuetypes","self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"},"issuetypes":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10311&avatarType=issuetype","name":"Feature","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10311&avatarType=issuetype","name":"Feature","subtask":false,"avatarId":10311}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jira.artack.ch/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10310&avatarType=issuetype","name":"Improvement","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10310&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":10310}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jira.artack.ch/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10303&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":10303}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"customfield_10900":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textfield","customId":10900},"name":"Loghash","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"customfield_10901":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10901},"name":"Logcount","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jira.artack.ch/rest/api/2/issuetype/10001","id":"10001","description":"Created by Jira Software - do not edit or delete. Issue type for a user story.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10315&avatarType=issuetype","name":"Story","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/10001","id":"10001","description":"Created by Jira Software - do not edit or delete. Issue type for a user story.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10315&avatarType=issuetype","name":"Story","subtask":false,"avatarId":10315}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jira.artack.ch/rest/api/2/issuetype/10000","id":"10000","description":"Created by Jira Software - do not edit or delete. Issue type for a big user story that needs to be broken down.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10307&avatarType=issuetype","name":"Epic","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/10000","id":"10000","description":"Created by Jira Software - do not edit or delete. Issue type for a big user story that needs to be broken down.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10307&avatarType=issuetype","name":"Epic","subtask":false,"avatarId":10307}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jira.artack.ch/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"avatarId":10318}]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}},{"self":"https://jira.artack.ch/rest/api/2/issuetype/5","id":"5","description":"The sub-task of the issue","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10316&avatarType=issuetype","name":"Sub-task","subtask":true,"expand":"fields","fields":{"summary":{"required":true,"schema":{"type":"string","system":"summary"},"name":"Summary","hasDefaultValue":false,"operations":["set"]},"issuetype":{"required":true,"schema":{"type":"issuetype","system":"issuetype"},"name":"Issue Type","hasDefaultValue":false,"operations":[],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/issuetype/5","id":"5","description":"The sub-task of the issue","iconUrl":"https://jira.artack.ch/secure/viewavatar?size=xsmall&avatarId=10316&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":10316}]},"parent":{"required":true,"schema":{"type":"issuelink","system":"parent"},"name":"Parent","hasDefaultValue":false,"operations":["set"]},"description":{"required":false,"schema":{"type":"string","system":"description"},"name":"Description","hasDefaultValue":false,"operations":["set"]},"project":{"required":true,"schema":{"type":"project","system":"project"},"name":"Project","hasDefaultValue":false,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/project/10000","id":"10000","key":"MX","name":"mailXpert","avatarUrls":{"48x48":"https://jira.artack.ch/secure/projectavatar?pid=10000&avatarId=10408","24x24":"https://jira.artack.ch/secure/projectavatar?size=small&pid=10000&avatarId=10408","16x16":"https://jira.artack.ch/secure/projectavatar?size=xsmall&pid=10000&avatarId=10408","32x32":"https://jira.artack.ch/secure/projectavatar?size=medium&pid=10000&avatarId=10408"}}]},"reporter":{"required":true,"schema":{"type":"user","system":"reporter"},"name":"Reporter","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/search?username=","hasDefaultValue":false,"operations":["set"]},"priority":{"required":false,"schema":{"type":"priority","system":"priority"},"name":"Priority","hasDefaultValue":true,"operations":["set"],"allowedValues":[{"self":"https://jira.artack.ch/rest/api/2/priority/1","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},{"self":"https://jira.artack.ch/rest/api/2/priority/2","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Critical","id":"2"},{"self":"https://jira.artack.ch/rest/api/2/priority/3","iconUrl":"https://jira.artack.ch/images/icons/priorities/major.svg","name":"Major","id":"3"},{"self":"https://jira.artack.ch/rest/api/2/priority/10000","iconUrl":"https://jira.artack.ch/images/icons/newfeature.gif","name":"Normal","id":"10000"},{"self":"https://jira.artack.ch/rest/api/2/priority/4","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Minor","id":"4"},{"self":"https://jira.artack.ch/rest/api/2/priority/5","iconUrl":"https://jira.artack.ch/images/icons/priorities/trivial.svg","name":"Trivial","id":"5"},{"self":"https://jira.artack.ch/rest/api/2/priority/10100","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Medium","id":"10100"},{"self":"https://jira.artack.ch/rest/api/2/priority/10101","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Highest","id":"10101"},{"self":"https://jira.artack.ch/rest/api/2/priority/10102","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"High","id":"10102"},{"self":"https://jira.artack.ch/rest/api/2/priority/10103","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Low","id":"10103"},{"self":"https://jira.artack.ch/rest/api/2/priority/10104","iconUrl":"https://jira.artack.ch/images/icons/priority_major.gif","name":"Lowest","id":"10104"},{"self":"https://jira.artack.ch/rest/api/2/priority/10200","iconUrl":"https://jira.artack.ch/images/icons/priorities/blocker.svg","name":"Notfall","id":"10200"},{"self":"https://jira.artack.ch/rest/api/2/priority/10201","iconUrl":"https://jira.artack.ch/images/icons/priorities/critical.svg","name":"Mittlere Funktionsstörung","id":"10201"},{"self":"https://jira.artack.ch/rest/api/2/priority/10202","iconUrl":"https://jira.artack.ch/images/icons/priorities/minor.svg","name":"Nicht kritisches Problem","id":"10202"}]},"customfield_10500":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10500},"name":"Commercial value","hasDefaultValue":false,"operations":["set"]},"customfield_10501":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10501},"name":"Market value","hasDefaultValue":false,"operations":["set"]},"customfield_10006":{"required":false,"schema":{"type":"any","custom":"com.pyxis.greenhopper.jira:gh-epic-link","customId":10006},"name":"Epic Link","hasDefaultValue":false,"operations":["set"]},"customfield_10503":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10503},"name":"Efficiency value","hasDefaultValue":false,"operations":["set"]},"customfield_10504":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10504},"name":"Customer value","hasDefaultValue":false,"operations":["set"]},"attachment":{"required":false,"schema":{"type":"array","items":"attachment","system":"attachment"},"name":"Attachment","hasDefaultValue":false,"operations":[]},"customfield_10505":{"required":false,"schema":{"type":"number","custom":"com.atlassian.jira.plugin.system.customfieldtypes:float","customId":10505},"name":"Future value","hasDefaultValue":false,"operations":["set"]},"duedate":{"required":false,"schema":{"type":"date","system":"duedate"},"name":"Due Date","hasDefaultValue":false,"operations":["set"]},"customfield_10507":{"required":false,"schema":{"type":"string","custom":"com.atlassian.jira.plugin.system.customfieldtypes:textarea","customId":10507},"name":"Acceptance criterias","hasDefaultValue":false,"operations":["set"]},"issuelinks":{"required":false,"schema":{"type":"array","items":"issuelinks","system":"issuelinks"},"name":"Linked Issues","autoCompleteUrl":"https://jira.artack.ch/rest/api/2/issue/picker?currentProjectId=&showSubTaskParent=true&showSubTasks=true&currentIssueKey=null&query=","hasDefaultValue":false,"operations":["add"]},"assignee":{"required":false,"schema":{"type":"user","system":"assignee"},"name":"Assignee","autoCompleteUrl":"https://jira.artack.ch/rest/api/latest/user/assignable/search?issueKey=null&username=","hasDefaultValue":false,"operations":["set"]}}}]}]}';
    private const RESPONSE_BODY_CREATE_ISSUE = '{"id":"21103","key":"MX-2311","self":"https://jira.artack.ch/rest/api/2/issue/21103"}';

    public function testWithNonExistingIssue(): void
    {
        $httpClient = new Client();
        $httpClient->addResponse($this->createResponse(self::RESPONSE_BODY_CUSTOMFIELDS));
        $httpClient->addResponse($this->createResponse(self::RESPONSE_BODY_EXISTING_ISSUES_NONE));
        $httpClient->addResponse($this->createResponse(self::RESPONSE_BODY_CREATE_META));
        $httpClient->addResponse($this->createResponse(self::RESPONSE_BODY_CREATE_ISSUE));

        $handler = $this->createHandler($httpClient);
        $record = $this->getMultipleRecords();
        $handler->handleBatch($record);

        $this->assertSame('21103', $handler->getCreatedIssueId());
    }

    public function testWithExistingIssue(): void
    {
        $httpClient = new Client();
        $httpClient->addResponse($this->createResponse(self::RESPONSE_BODY_CUSTOMFIELDS));
        $httpClient->addResponse($this->createResponse(self::RESPONSE_BODY_EXISTING_ISSUES_ONE));

        $handler = $this->createHandler($httpClient);
        $record = $this->getMultipleRecords();
        $handler->handleBatch($record);

        $requests = $httpClient->getRequests();
        $this->assertCount(4, $requests);
    }

    private function createResponse(string $body): ResponseInterface
    {
        $response = new Response(200, self::RESPONSE_HEADERS, $body);
        $response->getBody()->rewind();

        return $response;
    }

    private function createHandler(ClientInterface $httpClient): JiraHandler
    {
        return new JiraHandler(
            'hostname',
            'username',
            'passowrd',
            'jql',
            'Loghash',
            'MX',
            'Bug',
            true,
            'Logcount',
            $httpClient,
            Logger::ERROR
        );
    }

    private function createMockedHandler()
    {
        $handler = $this->getMockBuilder(JiraHandler::class)
            ->setMethods(['getCustomFieldsData'])
            ->getMock();

        return $handler;
    }
}
